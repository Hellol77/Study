# 6장 변경 가능한 데이터 구조를 가진 언어에서 불변성 유지하기

중첩된 데이터 : 데이터 구조 안에 데이터 구조가 있는 경우 데이터가 `중첩`되었다고 말합니다.

불변성 원칙은 카피-온-라이트(copy-on-write)라고 합니다.

---

### 카피 온 라이트 원칙

1. 복사본 만들기
2. 복사본 변경하기(원하는 만큼)
3. 복사본 리턴하기

### 쓰기도 하면서 읽기도 하는 동작은 어떻게 해야 할까요?

1. 읽기와 쓰기 함수로 각각 분리한다.
2. 함수에서 값을 두 개 리턴한다.


### 불변 데이터 구조를 읽는 것은 계산입니다.

1. 변경 가능한 데이터를 읽는 것은 액션입니다.
    - 변경 가능한 값을 읽을 때마다 다른 값을 읽을 수도 있습니다. 따라서 변경 가능한 데이터를 읽는 것은 액션입니다.
2. 쓰기는 데이터를 변경 가능한 구조로 만듭니다.
3. 어떤 데이터에 쓰기가 없다면 데이터는 변경 불가능한 데이터입니다.
4. 불변 데이터 구조를 읽는 것은 계산입니다.
    - 어떤 데이터를 불변형으로 만들었다면 그 데이터에 모든 읽기는 계산입니다.
5. 쓰기를 읽기로 바꾸면 코드에 계산이 많아집니다.
    - 쓰기를 읽기로 바꾸면 코드에 계산이 많아집니다.

### 불변 데이터 구조는 충분히 빠릅니다.
> 바뀔 때마다 복사를 하면 너무 비효율적인 것이 아닌가요?

- 언제든 최적화 할 수 있습니다.

- 가비지 콜렉터는 매우 빠릅니다.

- 생각보다 많이 복사하지 않습니다.

- 함수형 프로그래밍 언어에는 빠른 구현체가 있습니다.


### 자바스크립트 복사하기

```js
Object.assign(a,b)
```
b객체에 모든 키 값을 a 객체로 복사합니다.(값이 변경됩니다.)

빈 객체에 모든 키/값 쌍을 복사해서 b의 복사본을 만들 수 있습니다.


### 요점 정리

- 함수형 프로그래밍에서 불변 데이터가 필요합니다. 계산에서는 변경 가능한 데이터에 쓰기를 할 수 없습니다.

- 카피-온-라이트는 데이터를 불변형으로 유지할 수 있는 원칙입니다. 복사본을 만들고 원본 대신 복사본을 변경하는 것을 말합니다.

- 카피-온-라이트는 값을 변경하기 전에 얕은 복사를 합니다. 그리고 리턴합니다. 이렇게 하면 통제할 수 있는 범위에서 불변성을 구현할 수 있습니다.

- 보일러 플레이트 코드를 줄이기 위해 기본적인 배열과 객체 동작에 대한 카피-온-라이트 버전을 만들어 두는 것이 좋습니다. 